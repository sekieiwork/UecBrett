{% extends "base_layout.html" %}

{% block title %}管理者ダッシュボード{% endblock %}

{% block content %}
    <h1>管理者ダッシュボード</h1>
    
    <h2>ユーザー一覧</h2>
    <div class="admin-list-container">
        <ul>
        {% for user in users %}
            <li>
                {{ user.username }}
                <form action="{{ url_for('admin_delete_user', user_id=user.id) }}" method="POST" style="display:inline;">
                    <button type="submit">削除</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    </div>

    <h2>投稿一覧</h2>
    <div class="admin-list-container">
        <ul>
        {% for post in posts %}
            <li>
                {{ post.title }} (投稿者: {{ post.author.username }})
                <form action="{{ url_for('admin_delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
                    <button type="submit">削除</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    </div>
    
    <h2>コメント一覧</h2>
    <div class="admin-list-container">
        <ul>
        {% for comment in comments %}
            <li>
                {{ comment.content }} (投稿者: {{ comment.commenter.username }})
                <form action="{{ url_for('admin_delete_comment', comment_id=comment.id) }}" method="POST" style="display:inline;">
                    <button type="submit">削除</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    </div>

    <div class="post-form" style="margin-bottom: 20px; border-left: 5px solid #ffc107;">
        <h3>🔧 開発者用ツール</h3>
        
        <p>ToDoの期限通知ロジックを強制的に実行します。</p>
        <form action="{{ url_for('admin_test_todo_notifications') }}" method="POST" style="margin-bottom: 15px;">
            <button type="submit" class="file-upload-btn" style="background-color: #ffc107; color: #000;">
                <i class="fas fa-bell"></i> 通知テストを実行
            </button>
        </form>

        <hr>
        <p><strong>タグ一括復元</strong><br>
        全投稿をチェックし、レビュー形式の本文であれば強制的に「review」タグを付与します。<br>
        （タグが消失した事故の復旧用）</p>
        <form action="{{ url_for('admin_restore_tags') }}" method="POST">
            <button type="submit" class="file-upload-btn" style="background-color: #17a2b8; color: #fff;">
                <i class="fas fa-tags"></i> reviewタグを復元
            </button>
        </form>
    </div>

    <div style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 15px;">
        <p style="margin-bottom: 5px;"><strong>初回ガイドの表示テスト</strong><br>
        自分の「ガイド既読」状態をリセットして、トップページへ移動します。</p>
        <form action="{{ url_for('admin_reset_guide_status') }}" method="POST">
            <button type="submit" class="file-upload-btn" style="background-color: #17a2b8; color: #fff;">
                <i class="fas fa-undo"></i> リセットして確認
            </button>
        </form>
    </div>
{% endblock %}