{% extends "base_layout.html" %}

{% block title %}ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
    <h1>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
    
    <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h2>
    <div class="admin-list-container">
        <ul>
        {% for user in users %}
            <li>
                {{ user.username }}
                <form action="{{ url_for('admin_delete_user', user_id=user.id) }}" method="POST" style="display:inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/> <button type="submit">å‰Šé™¤</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    </div>

    <h2>æŠ•ç¨¿ä¸€è¦§</h2>
    <div class="admin-list-container">
        <ul>
        {% for post in posts %}
            <li>
                {{ post.title }} (æŠ•ç¨¿è€…: {{ post.author.username }})
                <form action="{{ url_for('admin_delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
                   <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/> <button type="submit">å‰Šé™¤</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    </div>
    
    <h2>ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§</h2>
    <div class="admin-list-container">
        <ul>
        {% for comment in comments %}
            <li>
                {{ comment.content }} (æŠ•ç¨¿è€…: {{ comment.commenter.username }})
                <form action="{{ url_for('admin_delete_comment', comment_id=comment.id) }}" method="POST" style="display:inline;">
                   <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/> <button type="submit">å‰Šé™¤</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    </div>

    <h2>ç§‘ç›®ä¿®æ­£ãƒ»æ­£è¦åŒ–ç”³è«‹</h2>
    <div class="admin-list-container">
        {% if subject_requests %}
            <ul>
            {% for req in subject_requests %}
                <li style="margin-bottom: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px;">
                    <strong>{{ req.subject_name }}</strong> ({{ req.year }})<br>
                    <span style="font-size: 0.9em; color: #666;">ç”³è«‹è€…: {{ req.user.username }} - {{ req.timestamp.strftime('%Y/%m/%d') }}</span>
                    
                    <form action="{{ url_for('resolve_subject_request', request_id=req.id) }}" method="POST" style="display:inline; margin-left: 10px;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="file-upload-btn" style="background-color: #28a745; padding: 2px 8px; font-size: 0.8em;">è§£æ±ºæ¸ˆã¿ã«ã™ã‚‹</button>
                    </form>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>æœªå¯¾å¿œã®ç”³è«‹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endif %}
    </div>

    <h3 style="margin-top: 30px; color: #28a745;">æ‰¿èªæ¸ˆã¿ç§‘ç›®ãƒªã‚¹ãƒˆ (æ­£è¦åŒ–ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ)</h3>
    <div class="admin-list-container">
        {% if approved_requests %}
            <ul>
            {% for req in approved_requests %}
                <li style="margin-bottom: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px;">
                    <strong>{{ req.subject_name }}</strong> ({{ req.year }})<br>
                    <span style="font-size: 0.9em; color: #666;">ç”³è«‹è€…: {{ req.user.username }}</span>
                    
                    <form action="{{ url_for('revoke_subject_request', request_id=req.id) }}" method="POST" style="display:inline; margin-left: 10px;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="file-upload-btn" style="background-color: #dc3545; padding: 2px 8px; font-size: 0.8em;" onclick="return confirm('æœ¬å½“ã«ã“ã®ç§‘ç›®ã®æ‰¿èªã‚’å–ã‚Šæ¶ˆã—ã¾ã™ã‹ï¼Ÿ\næ¬¡å›ã‹ã‚‰å†ã³ã€Œåˆ¤åˆ¥ä¸æ˜ã€æ‰±ã„ã«ãªã‚Šã¾ã™ã€‚')">æ’¤å› (å‰Šé™¤)</button>
                    </form>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>æ‰¿èªæ¸ˆã¿ã®ç§‘ç›®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
        {% endif %}
    </div>

    <div class="post-form" style="margin-bottom: 20px; border-left: 5px solid #ffc107;">
        <h3>ğŸ”§ é–‹ç™ºè€…ç”¨ãƒ„ãƒ¼ãƒ«</h3>
        
        <p>ToDoã®æœŸé™é€šçŸ¥ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¼·åˆ¶çš„ã«å®Ÿè¡Œã—ã¾ã™ã€‚</p>
        <form action="{{ url_for('admin_test_todo_notifications') }}" method="POST" style="margin-bottom: 15px;">
            <button type="submit" class="file-upload-btn" style="background-color: #ffc107; color: #000;">
                <i class="fas fa-bell"></i> é€šçŸ¥ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
            </button>
        </form>

        <hr>
        <p><strong>ã‚¿ã‚°ä¸€æ‹¬å¾©å…ƒ</strong><br>
        å…¨æŠ•ç¨¿ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼å½¢å¼ã®æœ¬æ–‡ã§ã‚ã‚Œã°å¼·åˆ¶çš„ã«ã€Œreviewã€ã‚¿ã‚°ã‚’ä»˜ä¸ã—ã¾ã™ã€‚<br>
        ï¼ˆã‚¿ã‚°ãŒæ¶ˆå¤±ã—ãŸäº‹æ•…ã®å¾©æ—§ç”¨ï¼‰</p>
        <form action="{{ url_for('admin_restore_tags') }}" method="POST">
            <button type="submit" class="file-upload-btn" style="background-color: #17a2b8; color: #fff;">
                <i class="fas fa-tags"></i> reviewã‚¿ã‚°ã‚’å¾©å…ƒ
            </button>
        </form>
    </div>

    <div style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 15px;">
        <p style="margin-bottom: 5px;"><strong>åˆå›ã‚¬ã‚¤ãƒ‰ã®è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</strong><br>
        è‡ªåˆ†ã®ã€Œã‚¬ã‚¤ãƒ‰æ—¢èª­ã€çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™ã€‚</p>
        <form action="{{ url_for('admin_reset_guide_status') }}" method="POST">
            <button type="submit" class="file-upload-btn" style="background-color: #17a2b8; color: #fff;">
                <i class="fas fa-undo"></i> ãƒªã‚»ãƒƒãƒˆã—ã¦ç¢ºèª
            </button>
        </form>
    </div>
{% endblock %}