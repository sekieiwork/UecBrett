{% extends "base_layout.html" %}

{% block title %}プロフィール編集{% endblock %}

{% block content %}
    <h1>プロフィール編集</h1>

    <form method="POST" enctype="multipart/form-data" id="profile-edit-form">
    {{ form.csrf_token }}
        <div class="form-field">
            {{ form.username.label }}<br>
            {{ form.username(size=20, id="username-input", **{'data-original-username': current_user.username}) }}
            {% for error in form.username.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
        </div>

        <div class="form-field">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5em;">
                <label for="bio">{{ form.bio.label }}</label>
                <a href="javascript:void(0)" id="toggle-tag-form-btn" title="タグを編集">
                    <img src="{{ url_for('static', filename='icons/ei-tag.png') }}" alt="タグ" style="width: 24px; height: 24px; vertical-align: middle;">
                </a>
            </div>
            {{ form.bio(cols=40, rows=5) }}
        </div>

        <div id="tag-form-container" class="form-field hidden" style="position: relative;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5em;">
                <label for="tags-input-field">タグ (カンマ区切りで入力)</label>
                <a href="javascript:void(0)" id="recent-tags-toggle" title="最近使用したタグ">
                    <img src="{{ url_for('static', filename='icons/underdir.png') }}" alt="最近のタグ" style="width: 20px; height: 20px;">
                </a>
            </div>
            <div id="recent-tags-list" class="recent-tags-dropdown hidden">
                </div>
            {{ form.tags(id="tags-input-field", placeholder="例: nクラス, review, B2") }}
        </div>

        <div class="affiliation-form-container">
        
            <div class="form-field" id="form-field-grade">
                {{ form.grade.label }}<br>
                {{ form.grade(id="form-select-grade") }}
            </div>

            <div class="form-field" id="form-field-category" style="display: none;">
                {{ form.category.label }}<br>
                {{ form.category(id="form-select-category") }}
            </div>

            <div class="form-field" id="form-field-class" style="display: none;">
                {{ form.user_class.label }}<br>
                {{ form.user_class(id="form-select-class") }}
            </div>
            
            <div class="form-field" id="form-field-program" style="display: none;">
                {{ form.program.label }}<br>
                {{ form.program(id="form-select-program") }}
            </div>

            <div class="form-field" id="form-field-major" style="display: none;">
                {{ form.major.label }}<br>
                {{ form.major(id="form-select-major") }}
            </div>
        </div>
        
        <div class="form-field">
            <label for="icon-input-field" class="file-upload-btn">アイコン画像を選択</label>
            {{ form.icon(id="icon-input-field", accept="image/jpeg, image/png, image/gif, image/heic, image/heif", style="display: none;") }}
            <span id="icon-filename-display" style="font-size: 0.8em; color: #6c757d; margin-left: 10px;"></span>
        </div>
        <div class="form-field" style="background: none; border: none; box-shadow: none; padding: 0;">
          {{ form.submit }}
        </div>
    </form>
{% endblock %}


{% block scripts %}
{% endblock %}