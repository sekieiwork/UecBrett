{% extends "layout.html" %}

{% block title %}投稿編集 - {{ post.title }}{% endblock %}

{% block content %}
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>投稿編集</h1>
        {% if templates %}
        <div class="template-dropdown">
            <button type="button" class="template-select-btn">テンプレートを選択</button>
            <div class="template-dropdown-content hidden">
                {% for t in templates %}
                <a href="#" class="template-item" data-index="{{ loop.index0 }}">{{ t.name }}</a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    <form method="POST" enctype="multipart/form-data">
        {{ form.csrf_token }}
        <div class="form-field">
            {{ form.title.label }}<br>
            {{ form.title() }}
        </div>
        <div class="form-field">
            {{ form.content.label }}<br>
            {{ form.content(cols=40, rows=5, class="auto-resize-textarea") }}
        </div>
        
        <div class="form-field" style="margin-top: 1em;">
            <label for="image">画像を変更</label><br>
            <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                <label for="image" style="cursor: pointer;">
                    <img src="{{ url_for('static', filename='icons/image_upload.png') }}" alt="画像アップロード" style="width: 24px; height: 24px; vertical-align: middle;">
                </label>
                {{ form.image(style="display: none;") }}
                <span id="edit-image-filename-display" style="font-size: 0.8em; color: #6c757d;">
                    {% if post.image_url %}
                        現在設定中の画像: {{ post.image_url.split('/')[-1] }}
                    {% else %}
                        画像がありません
                    {% endif %}
                </span>
            </div>
            {% if post.image_url %}
                <div style="margin-top: 10px;">
                    <p style="font-size: 0.8em; margin-bottom: 5px;">現在の画像:</p>
                    <img src="{{ post.image_url }}" alt="現在の画像" class="post-image" style="max-width: 200px;">
                </div>
            {% endif %}
        </div>
        
        <div style="margin-top: 1.5em; display: flex; align-items: center; gap: 1em;">
            {{ form.submit(value='更新') }}
            <a href="{{ url_for('post_detail', post_id=post.id) }}">戻る</a>
        </div>
        </form>
{% endblock %}