{% extends "layout.html" %}

{% block title %}投稿編集 - {{ post.title }}{% endblock %}

{% block content %}
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>投稿編集</h1>
        {% if templates %}
	<div style="text-align: right; margin-bottom: 1em;">
        	<div class="template-dropdown">
            		<button type="button" class="template-select-btn">テンプレートを選択</button>
            		<div class="template-dropdown-content hidden">
                		{% for t in templates %}
                		<a href="#" class="template-item" data-index="{{ loop.index0 }}">{{ t.name }}</a>
                		{% endfor %}
            		</div>
        	</div>
	</div>
        {% endif %}
    </div>
    <form method="POST" enctype="multipart/form-data">
        {{ form.csrf_token }}
        <div class="form-field">
            {{ form.title.label }}<br>
            {{ form.title() }}
        </div>
        <div class="form-field" id="content-field-original"> 
	    {{ form.content.label }}<br>
            {{ form.content(cols=40, rows=5, class="auto-resize-textarea") }}
        </div>

        <div id="uecreview-form-container" class="hidden">
            </div>
        
        <div class="form-field" style="margin-top: 1em;">
            <label for="image">画像を変更</label><br>
            <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                <label for="image" style="cursor: pointer;">
                    <img src="{{ url_for('static', filename='icons/image_upload.png') }}" alt="画像アップロード" style="width: 24px; height: 24px; vertical-align: middle;">
                </label>
                {{ form.image(style="display: none;", accept="image/jpeg, image/png, image/gif") }}
                <span id="edit-image-filename-display" style="font-size: 0.8em; color: #6c757d;">
                    {% if post.image_url %}
                        現在設定中の画像: {{ post.image_url.split('/')[-1] }}
                    {% else %}
                        画像がありません
                    {% endif %}
                </span>
            </div>
            {% if post.image_url %}
                <div style="margin-top: 10px;">
                    <p style="font-size: 0.8em; margin-bottom: 5px;">現在の画像:</p>
                    <img src="{{ post.image_url }}" alt="現在の画像" class="post-image" style="max-width: 200px;">
                </div>
            {% endif %}
        </div>
        
        <div style="margin-top: 1.5em; display: flex; align-items: center; justify-content: space-between;">
            {{ form.submit(value='更新') }}
            <a href="{{ url_for('post_detail', post_id=post.id) }}">更新せずに戻る</a>
        </div>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Flask-WTFによって生成されるであろうIDを使って要素を取得します
            // タイトル入力欄のIDは 'title', 本文入力欄のIDは 'content' になるのが一般的です
            const titleInput = document.getElementById('title');
            const contentTextarea = document.getElementById('content');

            // 要素が両方とも存在する場合のみ、処理を実行します
            if (titleInput && contentTextarea) {
                titleInput.addEventListener('keydown', function(event) {
                    // 押されたキーが 'Enter' だったら
                    if (event.key === 'Enter') {
                        // 1. フォームが送信されるのを防ぎます
                        event.preventDefault();
                        // 2. 本文のテキストエリアにフォーカスを移動させます
                        contentTextarea.focus();
                    }
                });
            }
        });
    </script>
    {% endblock %}